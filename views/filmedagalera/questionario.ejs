<main>
    <h2>Queremos saber dos seus gostos!</h2>

    <div class="caixa-texto">
        <h4>Responda com sinceridade</h4>
        <h5>de 0 até 10</h5>
        <h5>dê 5 caso não tenha visto</h5>
    </div>

    <div>
        <!-- Formulário para inserir o nome do usuário -->
        <input type="text" id="nomeUsuario" placeholder="Nome">
    </div>

    <!-- Tabela de filmes -->
    <table style="margin-top: 20px;">
        <thead>
            <tr>
                <th>Obra</th>
                <th>Avaliação</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>
                    <img src="/img/recomendacao/1.png" alt="Minha Mãe é uma Peça">
                </td>
                <td>
                    <input type="number" id="notaFilme1" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/2.png" alt="Até que a sorte nos separe">
                </td>
                <td>
                    <input type="number" id="notaFilme2" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/3.png" alt="Pânico">
                </td>
                <td>
                    <input type="number" id="notaFilme3" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/4.png" alt="IT: A coisa">
                </td>
                <td>
                    <input type="number" id="notaFilme4" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/5.png" alt="Vingadores">
                </td>
                <td>
                    <input type="number" id="notaFilme5" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/6.png" alt="Velozes e Furiosos">
                </td>
                <td>
                    <input type="number" id="notaFilme6" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/7.png" alt="Jumanji">
                </td>
                <td>
                    <input type="number" id="notaFilme7" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/8.png" alt="Avatar">
                </td>
                <td>
                    <input type="number" id="notaFilme8" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/9.png" alt="Star Wars">
                </td>
                <td>
                    <input type="number" id="notaFilme9" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/10.png" alt="Interestelar">
                </td>
                <td>
                    <input type="number" id="notaFilme10" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/11.png" alt="Lala Land">
                </td>
                <td>
                    <input type="number" id="notaFilme11" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/12.png" alt="Crepúsculo">
                </td>
                <td>
                    <input type="number" id="notaFilme12" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/13.png" alt="Homem-Aranha: Aranhaverso">
                </td>
                <td>
                    <input type="number" id="notaFilme13" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/14.png" alt="Shrek">
                </td>
                <td>
                    <input type="number" id="notaFilme14" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/15.png" alt="A Vida é Bela">
                </td>
                <td>
                    <input type="number" id="notaFilme15" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/16.png" alt="Euphoria">
                </td>
                <td>
                    <input type="number" id="notaFilme16" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/17.png" alt="Turma da Mônica">
                </td>
                <td>
                    <input type="number" id="notaFilme17" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
            <tr>
                <td>
                    <img src="/img/recomendacao/18.png" alt="Procurando Nemo">
                </td>
                <td>
                    <input type="number" id="notaFilme18" min="0" max="10" placeholder="Nota">
                </td>
            </tr>
        </tbody>
    </table>

    <!-- Botão para salvar os dados -->
    <button class="branco" onclick="salvarAvaliacoes()" style="margin-top: 10px;">Salvar</button>
</main>


<style>
    main {
        text-align: center;
    }
    /* Estilo para o botão (agora um link) */
    .branco {
        display: inline-block; /* Necessário para comportar margens como um botão */
        padding: 10px 20px;
        background-color: white; /* Branco */
        color: #333; /* Cor do texto */
        border: 1px solid #ccc; /* Borda clara */
        border-radius: 5px;
        text-decoration: none; /* Remove o sublinhado padrão dos links */
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .branco:hover {
        background-color: #f1f1f1; /* Tom mais claro no hover */
        cursor: url('/img/cursor-mao.png'), auto;
    }

    input[type="text"] {
        margin-top: 10px; /* Espaçamento superior para o botão */
        width: 80%; /* Largura ajustável */
        max-width: 400px; /* Limita a largura máxima */
        padding: 12px 20px; /* Espaçamento interno */
        font-size: 16px; /* Tamanho da fonte */
        border: 1px solid #ccc; /* Cor da borda */
        border-radius: 8px; /* Bordas arredondadas */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Sombra sutil */
        outline: none; /* Remove o outline padrão */
        transition: all 0.3s ease; /* Animação suave */
        opacity: 70%;
        margin-bottom: 20px; /* Adiciona espaçamento abaixo do input */
        cursor: url('/img/cursor-texto.png'), auto;
    }

    input[type="text"]:focus {
        border-color: #4caf50; /* Cor da borda ao focar */
        box-shadow: 0 4px 8px rgba(76, 175, 80, 0.4); /* Sombra mais destacada */
        opacity: 100%;
        cursor: url('/img/cursor-texto.png'), auto;
    }
</style>


<script type="module">
    /* ------- FUNÇÕES DO FIREBASE ------- */

    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-storage.js";
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";

    // Configuração do Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyDuwnu2XcSTJ1YZkgD4570AtE6uKci_nDQ",
        authDomain: "boteco-6fcfa.firebaseapp.com",
        projectId: "boteco-6fcfa",
        storageBucket: "boteco-6fcfa.appspot.com",
        messagingSenderId: "531032694476",
        appId: "1:531032694476:web:6e03bdd824b90fd2b2ec69"
    };

    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);

    /* ------- FUNÇÃO DE UPLOAD ------- */

    // Função de upload de arquivos para o Firebase Storage
    async function uploadFile(file, destinationPath) {
        if (!file) {
            exibirMensagem('Por favor, selecione um arquivo!', 'error');
            return false;  // Retorna false para indicar falha
        }

        // O nome do arquivo será o nome original (no caso do arquivo de texto gerado)
        const fileName = file.name; 
        const fileRef = ref(storage, `${destinationPath}/${fileName}`); // Definindo o caminho de destino no Firebase Storage

        try {
            // Fazendo o upload do arquivo
            const snapshot = await uploadBytes(fileRef, file);

            // Após o upload, retorna a URL de download
            exibirMensagem('Arquivo enviado com sucesso!', 'success');

            // Você pode, se necessário, retornar a URL do arquivo
            const downloadURL = await getDownloadURL(snapshot.ref);
            console.log('Arquivo enviado. URL de download:', downloadURL);

          return true;  // Retorna true para indicar sucesso
        } catch (error) {
            console.error('Erro ao enviar o arquivo:', error);
            exibirMensagem('Erro ao enviar o arquivo. Verifique a conexão e tente novamente.', 'error');
          return false;  // Retorna false em caso de erro
        }
    }

    /* ------- FUNÇÕES DO QUESTIONÁRIO ------- */

    // Função para exibir mensagens de sucesso ou erro
    function exibirMensagem(mensagem, tipo) {
        const msgContainer = document.createElement('div');
        msgContainer.textContent = mensagem;
        msgContainer.style.padding = '10px';
        msgContainer.style.margin = '10px';
        msgContainer.style.borderRadius = '5px';
        if (tipo === 'success') {
            msgContainer.style.backgroundColor = '#4caf50';
            msgContainer.style.color = 'white';
        } else if (tipo === 'error') {
            msgContainer.style.backgroundColor = '#f44336';
            msgContainer.style.color = 'white';
        }
        document.body.appendChild(msgContainer);

        // Remover mensagem após 3 segundos
        setTimeout(() => {
            msgContainer.remove();
        }, 3000);
    }

    // Função para salvar as avaliações do usuário
    async function salvarAvaliacoes() {
        const nomeUsuario = document.getElementById('nomeUsuario').value.trim();
        const notas = [];
        let alertaExibido = false; // Variável para controlar se o alerta foi exibido

        // Pega todas as notas inseridas dinamicamente
        const inputsNotas = document.querySelectorAll('input[type="number"]');
        inputsNotas.forEach(input => {
            const nota = input.value.trim();
            if (nota === '' && !alertaExibido) {
                alert('Por favor, insira notas para todos os filmes.');
                alertaExibido = true; // Marca como exibido para evitar repetições
            }
            if (nota !== '') {
                notas.push(parseInt(nota, 10));
            }
        });

        // Verifica se o alerta já foi exibido
        if (alertaExibido) return;

        alertaExibido = false;

        if (!nomeUsuario) {
            alert('Por favor, insira seu nome.');
            return;
        }

        const conteudo = `${nomeUsuario}\n[${notas.map(nota => `${nota}`).join(', ')}]`;

        // Criar um arquivo de texto com as avaliações
        const blob = new Blob([conteudo], { type: 'text/plain;charset=utf-8' });
        const file = new File([blob], `${nomeUsuario}.txt`, { type: 'text/plain' });

        const destinationPath = 'recomendacoes/usuarios'; // Caminho de destino no Firebase Storage
        const sucesso = await uploadFile(file, destinationPath);

        // Redirecionar somente se o envio for bem-sucedido
        if (sucesso) {
            window.location.href = '/filmedagalera'; // Redireciona para a página de recomendações
        }
    }

    // Tornar Funções visíveis ao html
    window.salvarAvaliacoes = salvarAvaliacoes;
</script>
    
    
<link rel="stylesheet" href="/pages/lista/style.css">