<aside class="right-sidebar" id="right-sidebar">
</aside>

<script>
searchUserDataForSidebar(localStorage.getItem('autenticationUserTag'));

function renderSidebarDireita(userDataForSidebar) {
    document.getElementById("right-sidebar").innerHTML =
    `<div class="user-box">
        <div class="user-box-picture">
        <a href="/forum/user?userTag=${userDataForSidebar.userTag}"><img src="${userDataForSidebar.profileImage}"></a>
        </div>
        <div class="user-box-nickname">
        <a href="/forum/user?userTag=${userDataForSidebar.userTag}">${userDataForSidebar.userTag}</a>
        </div>        
        <hr class="divisoria-sidebar"> <!-- Linha divisória -->
        <div class="user-box-info">
        <p>🗣️ ${userDataForSidebar.discussaoAmount} discussões</p>
        <p>👥 ${userDataForSidebar.friendAmount} amigos</p>
        <p>📌 ${userDataForSidebar.pinAmount} pins</p>
        </div>
        <hr class="divisoria-sidebar"> <!-- Linha divisória -->
        <div class="user-box-action">
        <p>📝 editar perfil</p>
        <hr class="divisoria-sidebar"> <!-- Linha divisória -->
        <button style="none" onclick="logout()"><p>💡logout</p></button>
        </div>
        
    </div>`;
}

function logout () {
    localStorage.removeItem("autenticationUserTag");
    window.location.href = "/forum/autenticacao";
}

function searchUserDataForSidebar(userTag) {
    if (!userTag) {
        console.error('precisamos do userTag do usuário para localiza-lo.');
        alert('precisamos do email do usuário para localiza-lo.');
        return;
    }

    // Conectar ao servidor de mensagens com parâmetros na URL
    const eventSource = new EventSource(`/stream-user?userTag=${userTag}`);

    eventSource.onmessage = (event) => {
        try {
            userDataForSidebar = JSON.parse(event.data);
            renderSidebarDireita(userDataForSidebar);
        } catch (error) {
            console.error('Erro ao processar os dados recebidos:', error);
        }
    };

    eventSource.onerror = (error) => {
        console.error('Erro na conexão com o servidor:', error);
        eventSource.close();
    };
}
</script>