<main>
    <div class="container">
        <div id="mostrador-de-cookies">Você tem 0 cookies!</div>
        <div id="cps">0 cookies/s</div>
        <button id="cookie">
            <img src="/img/cookie.png" alt="Cookie">
        </button>

        <div id="popup-reset" class="popup">
            <div id="popup-conteudo" class="popup-conteudo">
                <h3>Deseja mesmo deletar todo seu progresso?</h3>
                <div class="acoes">
                    <button class="deletar" onclick="resetarValores(), fecharPopupReset()">Deletar</button>
                    <button class="branco" onclick="fecharPopupReset()">Fechar</button>
                </div>
            </div>
        </div>

        <div id="popup-anticheating" class="popup">
            <div id="popup-conteudo" class="popup-conteudo">
                <h3>PARE IMEDIATAMENTE VOCÊ ESTÁ TRAPACENANDO!!!</h3>
                <div class="acoes">
                    <button class="branco" onclick="fecharPopupAnticheating()">Fechar</button>
                </div>
            </div>
        </div>

    </div>

    <!-- Barra lateral esquerda -->
    <div id="barra-esquerda" class="barra-lateral">
        <h2>Upgrade de Click</h2>
        <div id="lista-click"></div>
    </div>

    <!-- Barra lateral direita -->
    <div id="barra-direita" class="barra-lateral">
        <h2>Upgrade de Máquina</h2>
        <div id="lista-maquina"></div>
    </div>

    <!-- Indicador de multiplicador -->
    <div id="indicador-multiplicador-cookies">Multiplicador Cookie: 100%</div>

    <!-- Indicador de gerador automático -->
    <div id="indicador-maquina-cookies">Máquina de cookies: 0 cookie/s</div>

    <div id="versao-container">
        <div id="versao" class="versao">Versão: 1.2.4</div>
        <button id="reset" class="reset-btn" onclick="botaoReset()">Resetar</button>
    </div>
</main>

<style>
    main {
        text-align: center;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
    }

    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        background-color: #f9f9f936;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }

    #cookie img {
        -webkit-user-drag: none;
        pointer-events: none;
        width: 145px;
        height: auto;
    }

    #mostrador-de-cookies, #cps {
        font-family: Arial, sans-serif;
        font-size: 18px;
        color: #333;
    }

    button {
        background: none;
        border: none;
        padding: 0;
        cursor: url('/img/cursor-mao.png'), auto;
        user-select: none;
        -webkit-user-select: none;
        -webkit-touch-callout: none;
        transition: background-color 0.3s ease;
    }

    #indicador-multiplicador-cookies,
    #indicador-maquina-cookies {
        position: relative;
        top: 15px;
        background-color: #f9f9f936;
        padding: 10px;
        border-radius: 5px;
        font-family: Arial, sans-serif;
        font-size: 14px;
        color: #333;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    #indicador-maquina-cookies {
        margin-top: 10px;
    }

    .barra-lateral {
        position: fixed; /* Mantém as barras fixas nas laterais da tela */
        top: auto; /* Coloca as barras no topo da tela */
        width: 200px; /* Define a largura fixa */
        height: 85vh; /* Faz com que as barras cubram toda a altura da tela */
        background-color: rgba(0, 0, 0, 0.1); /* Cor de fundo para visibilidade */
        display: flex; /* Torna a barra flexível para alinhar o conteúdo */
        flex-direction: column; /* Empilha os itens verticalmente */
        align-items: flex-start; /* Alinha o conteúdo no topo */
        justify-content: center; /* Centraliza o conteúdo horizontalmente */
        padding-top: 10px; /* Adiciona um pequeno espaçamento no topo */
        pointer-events: auto; /* Permite interatividade */
    }

    #barra-esquerda {
        left: 0;
    }

    #barra-direita {
        right: 0;
    }

    #lista-click {
        display: block; /* Alterado de flex para block */
        padding: 10px;
        margin-top: 20px; /* Adiciona espaçamento entre o título e a lista de upgrades */
    }

    #lista-maquina {
        display: block; /* Alterado de flex para block */
        padding: 10px;
        margin-top: 20px; /* Adiciona espaçamento entre o título e a lista de upgrades */
    }

    .upgrade-item {
        background-color: rgba(238, 119, 119, 0.219);
        border: 2px solid #333;
        border-radius: 10px;
        padding: 15px;
        text-align: left;
        display: block; /* Alterado para empilhar verticalmente os itens */
        margin-bottom: 10px; /* Adiciona espaçamento entre os itens de upgrade */
    }

    .upgrade-item button {
        background-color: #4CAF50;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        cursor: url('/img/cursor-mao.png'), auto;
    }

    .upgrade-item button:hover {
        background-color: #45a049;
    }

    @media (max-width: 768px) {
        main {
            flex-direction: column;
        }

        .barra-lateral {
            position: relative;
            width: 100%; /* Ajustar para largura total no layout responsivo */
            height: auto; /* Permitir altura dinâmica */
            padding: 20px; /* Espaçamento interno */
            top: 80px;
            align-items: center;
        }

        #barra-esquerda {
            order: 1; /* Aparece logo após os cookies */
            align-items: center;
        }

        #barra-direita {
            order: 2; /* Aparece abaixo da esquerda */
            align-items: center;
        }

        .upgrade-item {
            align-items: center;
            text-align: center;
        }

        #cookie img {
            -webkit-user-drag: none;
            pointer-events: none;
            width: 205px;
            height: auto;
        }
    }

    .popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.288); /* Fundo semi-transparente */
        z-index: 1000;
        justify-content: center;
        align-items: center;
        backdrop-filter: blur(8px); /* Aplica o efeito de desfoque */
        overflow: hidden; /* Garante que nada saia da tela */
    }

    #popup-reset{
        display: none;    /* Inicialmente oculto */
    }

    #popup-anticheating{
        display: none;    /* Inicialmente oculto */
    }

    /* Estilo para o conteúdo do popup */
    .popup-conteudo {
        background-color: rgba(255, 255, 255, 0.212);
        padding: 20px;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center; /* Garante que os itens sejam centralizados verticalmente */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        position: relative;
        width: 80%; /* Ajuste de largura */
        max-width: 800px; /* Limite máximo de largura */
        max-height: 90vh; /* Limite máximo de altura */
        overflow: auto; /* Se o conteúdo exceder, exibe barras de rolagem */
    }

    .popup-conteudo img {
        justify-content: center;
        max-width: 100%; /* Limita a largura da imagem */
        max-height: 60vh; /* Limita a altura da imagem */
        object-fit: contain; /* Garante que a imagem mantenha a proporção correta */
        border-radius: 8px;
    }

    .popup-conteudo .acoes {
        margin-top: 20px;
        display: flex;
        gap: 10px;
        justify-content: center; /* Centraliza os botões */
    }

    .popup-conteudo .acoes .deletar {
        padding: 10px 20px;
        background-color: #ff4c4c; /* Vermelho */
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .popup-conteudo .acoes .deletar:hover {
        background-color: #ff2a2a; /* Tom mais intenso de vermelho */
        cursor: url('/img/cursor-mao.png'), auto;
    }

    /* Estilo para o botão de fechar */
    .popup-conteudo .acoes .branco {
        padding: 10px 20px;
        background-color: white; /* Branco */
        color: #333; /* Cor do texto */
        border: 1px solid #ccc; /* Borda clara */
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .popup-conteudo .acoes .branco:hover {
        background-color: #f1f1f1; /* Tom mais claro no hover */
        cursor: url('/img/cursor-mao.png'), auto;
    }

    #versao-container {
        position: fixed;
        bottom: 10px;
        left: 10px;
        display: flex;
        align-items: center;
        gap: 5px; /* Espaço entre a versão e o botão */
    }

    .versao {
        font-family: Arial, sans-serif;
        font-size: 12px;
        color: #333;
    }

    .reset-btn {
        background-color: #f04;
        color: white;
        padding: 5px 10px; /* Tamanho pequeno */
        font-size: 10px; /* Tamanho de texto menor */
        border-radius: 5px;
        cursor: url('/img/cursor-mao.png'), auto;
    }

    .reset-btn:hover {
        background-color: #c03;
    }
</style>

<script>
    // Variáveis globais
    let quantidadeCookies = 0;      // Variável para quantidade atual de cookies
    let multiplicadorCookie = 0;      // Variável para multiplicador de cookie por click
    const cookiesPorSegundoInicial = 0;  // Valor inicial para cookies por segundo
    let cookiesPorSegundo = cookiesPorSegundoInicial;
    const precoClickInicial = 25;    // Preço inicial para upgrade de click
    let precoClick = precoClickInicial;
    const precoMaquinaInicial = 60; // Preço inicial para upgrade de máquina
    let precoMaquina = precoMaquinaInicial;
    let clickTimestamps = [];       // Armazena os timestamps dos cliques
    const CPS_INTERVAL = 3000;      // Janela de tempo para cálculo de CPS (3 segundos)

    // Carregar valores do Local Storage ao iniciar
    document.addEventListener("DOMContentLoaded", () => {
        const cookiesSalvos = localStorage.getItem("quantidadeCookies");
        if (cookiesSalvos !== null) {
            quantidadeCookies = parseInt(cookiesSalvos, 10);
            document.getElementById("mostrador-de-cookies").textContent = `Você tem ${quantidadeCookies.toFixed(0)} cookies!`;
        }

        const multiplicadorSalvo = localStorage.getItem("multiplicadorCookie");
        if (multiplicadorSalvo !== null) {
            multiplicadorCookie = parseInt(multiplicadorSalvo, 10);
            atualizarIndicadorMultiplicador();
        }

        const upgradeClickSalvo = localStorage.getItem("precoClick");
        if (upgradeClickSalvo !== null) {
            precoClick = parseInt(upgradeClickSalvo, 10);
        }

        const upgradeMaquinaSalvo = localStorage.getItem("precoMaquina");
        if (upgradeMaquinaSalvo !== null) {
            precoMaquina = parseInt(upgradeMaquinaSalvo, 10);
        }

        // Corrigir a atribuição de cookiesPorSegundo
        const cpsSalvo = localStorage.getItem("cookiesPorSegundo");
        if (cpsSalvo !== null) {
            cookiesPorSegundo = parseFloat(cpsSalvo);  // Assegurando que é um número de ponto flutuante
            atualizarIndicadorMaquina();
        }
    });

    // Função para resetar os valores para o padrão inicial
    function resetarValores() {
        quantidadeCookies = 0;
        multiplicadorCookie = 0;
        cookiesPorSegundo = cookiesPorSegundoInicial;
        precoClick = precoClickInicial;
        precoMaquina = precoMaquinaInicial;

        // Atualizar elementos na interface
        atualizarIndicadorMultiplicador();
        atualizarIndicadorMaquina();
        document.getElementById("mostrador-de-cookies").textContent = `Você tem ${quantidadeCookies.toFixed(0)} cookies!`;
        document.getElementById("cps").textContent = `${cookiesPorSegundo.toFixed(1)} cookie/s`;

        // Limpar ofertas
        document.getElementById("lista-click").innerHTML = '';
        document.getElementById("lista-maquina").innerHTML = '';

        // Limpar armazenamento local
        localStorage.clear();
    }

    // Função para calcular multiplicador baseado no multiplicador
    function calcularMultiplicador(multiplicador) {
        return 1 + multiplicador / 100;
    }

    // Função para calcular CPS médio (cliques por segundo)
    function calcularCpsMedia() {
        const agora = Date.now();

        // Filtra cliques dentro dos últimos 3 segundos
        clickTimestamps = clickTimestamps.filter(timestamp => agora - timestamp <= CPS_INTERVAL);

        // Retorna a média de cliques por segundo
        return clickTimestamps.length / (CPS_INTERVAL / 1000);
    }

    // Função para adicionar cookies automáticos ao total
    function adicionarCookiesAutomaticos() {
        let totalCookies = 0;
        // Somatório de cookiesPorSegundo vezes o multiplicador calculado
        for (let i = 0; i < cookiesPorSegundo; i++) {
            totalCookies += calcularMultiplicador(multiplicadorCookie);
        }
        quantidadeCookies += totalCookies; // Atualiza a quantidade total de cookies
        document.getElementById("mostrador-de-cookies").textContent = `Você tem ${quantidadeCookies.toFixed(0)} cookies!`;
        localStorage.setItem("quantidadeCookies", Math.floor(quantidadeCookies)); // Atualiza o total de cookies no localStorage
        
        // Verifica upgrades automaticamente ao exibir os cookies
        if (quantidadeCookies >= precoClick && !document.getElementById('lista-click').innerHTML) {
            exibirOfertaClick();
        }
        if (quantidadeCookies >= precoMaquina && !document.getElementById('lista-maquina').innerHTML) {
            exibirOfertaMaquina();
        }
    }

    // Função de anti-cheating
    function antiCheating(cpsMedio){
        if (cpsMedio >= 11){
            document.getElementById("popup-anticheating").style.display = "flex";
        }
    }

    // Função para atualizar o CPS (cookies por segundo)
    function atualizarCps() {
        const cpsMediaClicks = calcularCpsMedia();
        antiCheating(cpsMediaClicks);
        const cpsTotal = cpsMediaClicks + cookiesPorSegundo * calcularMultiplicador(multiplicadorCookie); // Soma automática + média
        document.getElementById("cps").textContent = `${cpsTotal.toFixed(1)} cookies/s`;
    }

    // Atualiza monitor de CPS a cada 100ms
    setInterval(() => {
        atualizarCps(); // Atualiza a exibição do CPS
    }, 100);

    // Função para atualizar o indicador de multiplicador
    function atualizarIndicadorMultiplicador() {
        document.getElementById("indicador-multiplicador-cookies").textContent = `Multiplicador cookie: ${multiplicadorCookie + 100}%`;
    }

    // Função para atualizar o indicador de cookies por segundo
    function atualizarIndicadorMaquina() {
        document.getElementById("indicador-maquina-cookies").textContent = `Máquina de cookies: ${cookiesPorSegundo} cookies/s`;
    }

    // Função para atualizar o preço dos upgrades
    function atualizarPreco(upgrade) {
        return upgrade * 2;
    }

    // Função para exibir a oferta de upgrade de click
    function exibirOfertaClick() {
        const listaClicks = document.getElementById('lista-click');
        const novoClick = document.createElement('div');
        novoClick.classList.add('upgrade-item');
        novoClick.innerHTML = `
            <p>Aumentar multiplicador cookie em 20%!</p>
            <button class="comprar-click">Comprar por ${precoClick} cookies</button>
        `;
        listaClicks.appendChild(novoClick);
    }

    // Função para exibir a oferta de upgrade de máquina
    function exibirOfertaMaquina() {
        const listaMaquina = document.getElementById('lista-maquina');
        const novaMaquina = document.createElement('div');
        novaMaquina.classList.add('upgrade-item');
        novaMaquina.innerHTML = `
            <p>Aumentar produção automática de cookies em 30%!</p>
            <button class="comprar-maquina">Comprar por ${precoMaquina} cookies</button>
        `;
        listaMaquina.appendChild(novaMaquina);
    }

    // Função de compra de upgrade de click
    document.getElementById("lista-click").addEventListener("click", (e) => {
        if (e.target.classList.contains("comprar-click")) {
            if (quantidadeCookies >= precoClick) {
                quantidadeCookies -= precoClick;
                multiplicadorCookie += 20;
                precoClick = atualizarPreco(precoClick);
                localStorage.setItem("quantidadeCookies", quantidadeCookies);
                localStorage.setItem("multiplicadorCookie", multiplicadorCookie);
                localStorage.setItem("precoClick", precoClick);             // Salva o novo preço do upgrade
                atualizarIndicadorMultiplicador();
                document.getElementById("mostrador-de-cookies").textContent = `Você tem ${quantidadeCookies.toFixed(0)} cookies!`;
                document.getElementById('lista-click').innerHTML = '';      // Remove a oferta de upgrade após compra
            }
        }
    });

    // Função de compra de upgrade de máquina
    document.getElementById("lista-maquina").addEventListener("click", (e) => {
        if (e.target && e.target.classList.contains("comprar-maquina")) {
            if (quantidadeCookies >= precoMaquina) {
                quantidadeCookies -= precoMaquina;
                if (cookiesPorSegundo === 0){
                    cookiesPorSegundo = 1;
                }
                else{
                    cookiesPorSegundo += cookiesPorSegundo * 0.3; // Incrementa 30% ou começa com 1 cookie/s
                }
                precoMaquina = atualizarPreco(precoMaquina);
                localStorage.setItem("quantidadeCookies", quantidadeCookies); // Salva a quantidade de cookies
                localStorage.setItem("cookiesPorSegundo", cookiesPorSegundo); // Salva o valor de CPS (cookies por segundo)
                localStorage.setItem("precoMaquina", precoMaquina);           // Salva o novo preço do upgrade
                atualizarIndicadorMaquina();
                document.getElementById("mostrador-de-cookies").textContent = `Você tem ${quantidadeCookies.toFixed(0)} cookies!`;
                document.getElementById('lista-maquina').innerHTML = ''; // Remove oferta
            }
        }
    });

    // Evento de clique no cookie
    document.getElementById("cookie").addEventListener("click", () => {
        const multiplicador = calcularMultiplicador(multiplicadorCookie);
        quantidadeCookies += multiplicador;

        // Armazena o timestamp atual
        clickTimestamps.push(Date.now());

        // Atualiza o contador e CPS
        document.getElementById("mostrador-de-cookies").textContent = `Você tem ${quantidadeCookies.toFixed(0)} cookies!`;
        localStorage.setItem("quantidadeCookies", quantidadeCookies);
        atualizarCps();

        // Verifica upgrades
        if (quantidadeCookies >= precoClick && !document.getElementById('lista-click').innerHTML) {
            exibirOfertaClick();
        }
        if (quantidadeCookies >= precoMaquina && !document.getElementById('lista-maquina').innerHTML) {
            exibirOfertaMaquina();
        }
    });

    function botaoReset(){
        document.getElementById("popup-reset").style.display = "flex";
    }

    function fecharPopupReset(){
        document.getElementById("popup-reset").style.display = 'none';
    }

    function fecharPopupAnticheating(){
        document.getElementById("popup-anticheating").style.display = 'none';
    }

    // Adiciona os cookies da máquina a cada segundo
    setInterval(() => {
        adicionarCookiesAutomaticos();
    }, 1000); // A cada segundo

</script>