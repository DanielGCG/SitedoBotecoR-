<main>
    <h2>Cutuque algu√©m!</h2>

    <div class="caixa-texto">
        <h4>Para cutucar no Twitter</h4>
        <h5>Use o @dapessoa e escreva uma mensagem ~an√¥nima!~</h5>
    </div>

    <div class="caixa-texto">
        <!-- Campo de texto para o @mencionado -->
        <input class="entrada-texto" type="text" id="mention" placeholder="Digite @marcado" autocomplete="off" />
        <!-- Div para mostrar sugest√µes -->
        <div id="suggestions" class="suggestions"></div>
    
        <!-- Campo de texto para escrever a mensagem -->
        <textarea class="entrada-texto-grande" id="messageText" placeholder="Escreva o resto da mensagem..."></textarea>
    
        <!-- Bot√£o para enviar o tweet -->
        <button id="tweetButton">Postar Tweet</button>
    </div>    

    <div class="post-twitter"></div>

    <!-- Popup para exibir a imagem com fundo desfocado e bot√µes -->
    <div id="popup-senha" class="popup">
        <div id="popup-conteudo" class="popup-conteudo">
            <div class="acoes">
                <form id="passwordForm">
                    <h2>Autentica√ß√£o de Usu√°rio</h2>
                    <input type="password" id="password" placeholder="Digite a senha" />
                    <button onclick="checkPassword()">Verificar</button>
                    <p class="message" id="message"></p>
                </form>
            </div>
        </div>
    </div>
</main>

<style>
    main {
        text-align: center;
    }

    #popup-senha {
        display: flex;
        align-items: center;
    }

    .caixa-texto {
        margin: 20px auto;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .entrada-texto {
        margin-top: 10px; /* Espa√ßamento superior para o bot√£o */
        width: 80%; /* Largura ajust√°vel */
        max-width: 400px; /* Limita a largura m√°xima */
        padding: 12px 20px; /* Espa√ßamento interno */
        font-size: 16px; /* Tamanho da fonte */
        border: 1px solid #ccc; /* Cor da borda */
        border-radius: 8px; /* Bordas arredondadas */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Sombra sutil */
        outline: none; /* Remove o outline padr√£o */
        transition: all 0.3s ease; /* Anima√ß√£o suave */
        opacity: 70%;
        margin-bottom: 20px; /* Adiciona espa√ßamento abaixo do input */
        cursor: url('/img/cursor-texto.png'), auto;
    }

    .entrada-texto-grande {
        margin-top: 10px; /* Espa√ßamento superior */
        width: 80%; /* Largura ajust√°vel */
        max-width: 400px; /* Limita a largura m√°xima */
        height: 200px; /* Aumenta a altura vertical */
        padding: 12px 20px; /* Espa√ßamento interno */
        font-size: 16px; /* Tamanho da fonte */
        border: 1px solid #ccc; /* Cor da borda */
        border-radius: 8px; /* Bordas arredondadas */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Sombra sutil */
        outline: none; /* Remove o outline padr√£o */
        transition: all 0.3s ease; /* Anima√ß√£o suave */
        opacity: 70%;
        margin-bottom: 20px; /* Espa√ßamento abaixo */
        cursor: url('/img/cursor-texto.png'), auto;
        resize: vertical; /* Permite redimensionar somente verticalmente */
    }

    .entrada-texto:focus {
        border-color: #4caf50; /* Cor da borda ao focar */
        box-shadow: 0 4px 8px rgba(76, 175, 80, 0.4); /* Sombra mais destacada */
        opacity: 100%;
        cursor: url('/img/cursor-texto.png'), auto;
    }

    .entrada-texto-grande:focus {
        border-color: #4caf50; /* Cor da borda ao focar */
        box-shadow: 0 4px 8px rgba(76, 175, 80, 0.4); /* Sombra mais destacada */
        opacity: 100%;
        cursor: url('/img/cursor-texto.png'), auto;
    }

    #tweetButton {
        display: inline-block; /* Necess√°rio para comportar margens como um bot√£o */
        padding: 10px 20px;
        background-color: white; /* Branco */
        color: #333; /* Cor do texto */
        border: 1px solid #ccc; /* Borda clara */
        border-radius: 5px;
        text-decoration: none; /* Remove o sublinhado padr√£o dos links */
        transition: background-color 0.3s ease;
    }

    #tweetButton:hover {
        background-color: #f1f1f1; /* Tom mais claro no hover */
        cursor: url('/img/cursor-mao.png'), auto;
    }

    /* Estilo da aba de sugest√µes */
    #suggestions {
        display: none; /* Inicialmente oculto */
        width: 80%;
        max-width: 400px;
        background-color: white;
        text-align: left;
        max-height: 150px;
        overflow-y: auto;
        margin-bottom: 10px; /* Espa√ßamento entre sugest√µes e pr√≥ximo campo */
        font-size: 13px;
        border: 1px solid #ccc; /* Cor da borda */
        border-radius: 8px; /* Bordas arredondadas */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Sombra sutil */
    }

    #suggestions div {
        padding: 8px;
    }

    #suggestions div:hover {
        background-color: #f0f0f0;
        cursor: url('/img/cursor-mao.png'), auto;
    }
</style>

<link rel="stylesheet" href="/css/popup.css">

<script>
    const predefinedPassword = "vereador123";
    let validacaoUsuario;
    const suggestionsList = [
        '@ammyndoiim',
        '@botdoboteco',
        '@Bagriieeel',
        '@carollssssssss',
        '@chammittoo',
        '@Darksols_',
        '@elonmusk',
        '@f3rnandesz',
        '@GabrielXoxota',
        '@Gb_santos1811',
        '@gcg_daniel',
        '@giapropria',
        '@girlon_tv',
        '@horanxgeller',
        '@i2camacho',
        '@jairbolsonaro',
        '@JYPETWICE',
        '@joseluanpf',
        '@jogadorStick',
        '@lbbhangelita',
        '@Liraotrem',
        '@LulaOficial',
        '@oleonamjoao',
        '@palettelilith',
        '@Regis_trado18',
        '@Renan_PTA',
        '@snake_sorrel',
        '@Tal_Lento',
        '@taylorswift13',
        '@whoisnenes',
        '@yuzzu_94'
    ];

    document.addEventListener("DOMContentLoaded", () => {
        validacaoUsuario = localStorage.getItem("validacaoUsuario");
        if (validacaoUsuario !== null) {
            validacaoUsuario = JSON.parse(validacaoUsuario); // Converte para booleano ou outro tipo armazenado.
        } else {
            validacaoUsuario = false; // Valor padr√£o se n√£o existir no localStorage.
        }

        console.log("Valida√ß√£o do Usu√°rio:", validacaoUsuario);

        if (validacaoUsuario === true){
            document.getElementById("popup-senha").style.display = "none";
        }
    });

    
    function checkPassword() {
        console.log("verificando senha...");
        if (validacaoUsuario !== true){
            const inputPassword = document.getElementById("password").value;
            const messageElement = document.getElementById("message");

            if (inputPassword === predefinedPassword) {
                messageElement.textContent = "Senha correta!";
                messageElement.style.color = "green";
                document.getElementById("popup-senha").style.display = "none";
                localStorage.setItem("validacaoUsuario", validacaoUsuario = true);
            } else {
                messageElement.textContent = "Senha incorreta!";
                messageElement.style.color = "red";
                return checkPassword();
            }
        }
    }

    const mentionInput = document.getElementById('mention');
    const suggestionsDiv = document.getElementById('suggestions');

    // Filtrar e mostrar sugest√µes
    mentionInput.addEventListener('input', () => {
        const query = mentionInput.value.toLowerCase();
        suggestionsDiv.innerHTML = ''; // Limpar sugest√µes anteriores

        if (query.startsWith('@')) {
            const filteredSuggestions = suggestionsList.filter(item =>
                item.toLowerCase().startsWith(query)
            );

            // Exibir sugest√µes, se houver correspond√™ncias
            if (filteredSuggestions.length > 0) {
                suggestionsDiv.style.display = 'block';
                filteredSuggestions.forEach(suggestion => {
                    const suggestionDiv = document.createElement('div');
                    suggestionDiv.textContent = suggestion;

                    // Selecionar a sugest√£o ao clicar
                    suggestionDiv.addEventListener('click', () => {
                        mentionInput.value = suggestion;
                        suggestionsDiv.style.display = 'none'; // Esconde sugest√µes
                    });

                    suggestionsDiv.appendChild(suggestionDiv);
                });
            } else {
                suggestionsDiv.style.display = 'none'; // Oculta se n√£o houver sugest√µes
            }
        } else {
            suggestionsDiv.style.display = 'none'; // Oculta se a entrada n√£o come√ßar com "@"
        }
    });

    // Esconder sugest√µes ao clicar fora do campo de texto
    document.addEventListener('click', event => {
        if (event.target !== mentionInput && event.target.parentNode !== suggestionsDiv) {
            suggestionsDiv.style.display = 'none';
        }
    });

    // L√≥gica para envio de tweet
    document.getElementById('tweetButton').addEventListener('click', () => {
        if (validacaoUsuario !== true){
            alert("Usu√°rio sem permiss√£o para envio de tweet");
            return false;
        }

        const mention = mentionInput.value.trim();
        const messageText = document.getElementById('messageText').value.trim();

        if (!mention || !messageText) {
            alert('Por favor, preencha ambos os campos.');
            return;
        }

        const tweetText = `‚òù${mention}, ${messageText}



üîóhttps://www.boteco.live/cutucar`;

        fetch('/tweet', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ text: tweetText }),
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Tweet enviado com sucesso!');
                    document.getElementById('messageText').value = '';
                    document.getElementById('mention').value = '';
                } else {
                    alert('Erro ao enviar o tweet.');
                }
            })
            .catch(error => alert('Erro: ' + error.message));
    });
</script>