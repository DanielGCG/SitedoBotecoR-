<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mensagens</title>
  <style>
    h2 {
      margin-top: 0;
    }
    .mensagens {
      border: 1px solid #ccc;
      padding: 10px;
      margin-top: 10px;
      max-height: 300px;
      overflow-y: auto;
    }
    .mensagem {
      margin-bottom: 10px;
      padding: 5px;
      border-bottom: 1px solid #eee;
    }
    .mensagem:last-child {
      border-bottom: none;
    }
    #statusMessage {
      color: red;
      margin-top: 10px;
    }
  </style>
</head>
<body>
    <h2>Nova Discussão</h2>
    <input type="text" id="discussao" placeholder="nome da discussão" style="width: 80%;" required>
    <input type="text" id="exibitionName" placeholder="nome de exibição autor" style="width: 80%;" required>
    <input type="text" id="userTag" placeholder="@doAutor" style="width: 80%;" required>

    <select id="categoria" style="width: 80%;" required>
        <option value="" disabled selected>Selecione uma categoria</option>
        <option value="Destaques">Destaques</option>
        <option value="Computaria">Computaria</option>
        <option value="Fofoca">Fofoca</option>
        <option value="BSMP">BSMP</option>
        <option value="RPG">RPG</option>
      </select>

    <button id="post">Publicar</button>
    <p id="statusMessage"></p>
  </body>
  

<script>
    // Postar nova mensagem
    document.getElementById('post').addEventListener('click', async () => {
        const categoria = document.getElementById('categoria').value;
        const discussao = document.getElementById('discussao').value.trim();
        const exibitionName = document.getElementById('exibitionName').value;
        const userTag = document.getElementById('userTag').value;

        console.log (`[${categoria}, ${discussao}, ${exibitionName}, ${userTag}]`);

        if (!discussao || !userTag || !exibitionName || !categoria) {
            document.getElementById('statusMessage').textContent = 'A mensagem pode estar sem discussao e/ou autor e/ou categoria.';
            return;
        }

        try {
            const response = await fetch(`/criardiscussao`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ exibitionName, userTag, categoria, discussao }),
            });

            const responseData = await response.json();
            if (response.ok) {
                document.getElementById('statusMessage').textContent = 'Mensagem publicada com sucesso.';
                document.getElementById('discussao').value = ''; // Limpar o campo de entrada
                document.getElementById('userTag').value = ''; // Limpar o campo de entrada
                document.getElementById('exibitionName').value = ''; // Limpar o campo de entrada
                document.getElementById('categoria').value = ''; // Limpar o campo de entrada
            } else {
            document.getElementById('statusMessage').textContent = responseData.error || 'Erro ao publicar.';
            }
        } catch (error) {
            document.getElementById('statusMessage').textContent = `Erro: ${error.message}`;
        }
    });
    window.onload = function() {
        document.getElementById('discussao').value = ''; // Limpar o campo de entrada
        document.getElementById('userTag').value = ''; // Limpar o campo de entrada
        document.getElementById('exibitionName').value = ''; // Limpar o campo de entrada
        document.getElementById('categoria').value = ''; // Limpar o campo de entrada
    };
</script>